# FX自動売買システム要件定義書

## 1. システム概要

### 1.1 システム名
FX自動売買システム（ダウ理論・エリオット波動理論ベース）

### 1.2 システム目的
ダウ理論とエリオット波動理論に基づくスイングトレード戦略により、USDを含む主要通貨ペアの自動売買を行う。

### 1.3 基本方針
- デモ口座での検証後、実運用移行
- 段階的開発による確実な機能構築
- リスク管理を最優先とした設計

## 2. 機能要件

### 2.1 取引対象
- **対象通貨ペア**: USD/JPY、EUR/USD、GBP/USD、AUD/USD、USD/CHF、USD/CAD（6ペア全監視）
- **取引戦略**: ダウ理論 + エリオット波動理論ベースのスイングトレード
- **同時ポジション数**: 最大3ペア（設定で1-6ペア変更可能）
- **資金配分**: 動的配分（ボラティリティ・相関調整）

### 2.2 シグナル評価基準
**100点満点のスコアリング方式**

#### 2.2.1 評価項目
1. **トレンド強度（30点）**
   - ダウ理論での連続的な高値・安値更新回数（最大5回で30点）
   - 直近のスイングポイント間の角度（急峻ほど高得点）

2. **エリオット波動位置（40点）**
   - 第3波開始: 40点（最優先）
   - 第1波開始: 30点
   - 第5波開始: 20点
   - 修正波: 10点

3. **技術的確度（20点）**
   - フィボナッチ比率適合度（±5%以内で満点）
   - 複数時間軸での一致性（日足+4時間足の方向一致）

4. **市場環境（10点）**
   - ボラティリティ適正性（ATRが過去20日平均の80-120%で満点）
   - 流動性時間帯での発生（NY時間+5点、その他0点）

#### 2.2.2 相関調整機能
```
if USD/JPY選択済み and EUR/USD候補 then
    EUR/USDスコア × 0.7  // 強い逆相関のため減点
```

#### 2.2.3 運用ルール
- **スコア計算**: 5分毎に全ペア評価
- **入替条件**: 既存ポジションより15点以上高いシグナルで入替検討
- **最小保持期間**: 頻繁な入替を避けるため4時間以上の保持必須

### 2.3 リスク管理

#### 2.3.1 資金管理
- **1取引あたりの最大リスク**: 2%
- **全体の最大ドローダウン**: 15%（強制停止）
- **1日の最大損失額**: 制限なし

#### 2.3.2 ポジションサイズ計算
- ストップロス距離に基づく自動計算
- 各ペアのボラティリティ調整（ATRベース）
- 最小/最大ロットサイズ制限

#### 2.3.3 ストップロス・テイクプロフィット（未確定）
**ストップロス候補**
- ダウ理論基準: 直近スイングポイント + バッファ
- エリオット波動基準: 前波の起点 + バッファ
- ATR基準: ATR×1.5-2.0

**テイクプロフィット候補**
- フィボナッチターゲット: 161.8%、261.8%等
- リスクリワード固定: 1:2、1:3等
- トレーリングストップ

#### 2.3.4 取引時間制限
**避けるべき時間帯**
- 米雇用統計発表時（日本時間22:30前後1時間）
- FOMC発表時（日本時間翌3:00前後1時間）
- 日本時間3:00-7:00（流動性低下）

**その他制限**
- スプレッド異常拡大時の取引停止
- 急激なボラティリティ上昇時の新規エントリー停止

## 3. 技術要件

### 3.1 システム構成
**ハイブリッド構成**
```
[Python FastAPI] ←HTTP/WebSocket→ [MQL5 EA] ←→ [MetaTrader5] ←→ [ブローカー]
     ↓
[SQLiteDB] (履歴・ログ保存)
```

### 3.2 技術スタック

#### 3.2.1 Python側
- **フレームワーク**: FastAPI + uvicorn
- **ライブラリ**: 
  - pandas, numpy（データ処理）
  - TA-Lib（テクニカル指標）
  - sqlite3（データベース）
  - websockets（リアルタイム通信）

#### 3.2.2 MQL5側
- **形式**: Expert Advisor（EA）
- **機能**: 
  - HTTP Client（FastAPIとの通信）
  - 価格データ送信（5分毎に全6ペアのOHLCデータ）
  - シグナル受信・注文実行

#### 3.2.3 通信方式
- **プロトコル**: HTTP/WebSocket（TCP/IP）
- **データ形式**: JSON

### 3.3 API設計
- `GET /status`: システム状態確認
- `GET /signals`: 現在のシグナル状況  
- `POST /market-data`: MT5からの価格データ受信
- `WebSocket /ws`: リアルタイム双方向通信

### 3.4 運用環境
- **環境**: 自宅PC
- **OS**: Windows 10/11
- **ハードウェア要件**:
  - CPU: 4コア以上
  - メモリ: 8GB以上
  - ストレージ: SSD推奨
  - ネットワーク: 安定したインターネット接続

## 4. 開発計画

### 4.1 開発フェーズ

#### フェーズ1: 基本インフラ（1-2週間）
1. Python FastAPI基盤
   - 基本的なWebサーバー起動
   - ヘルスチェックAPI（`/status`）
   - ログ機能

2. MQL5 基本EA
   - HTTP通信機能
   - MetaTraderとの基本接続
   - 価格データ取得（1ペアのみ）

3. 通信テスト
   - Python ↔ MQL5間のデータ送受信確認

#### フェーズ2: シングルペア分析（2-3週間）
4. ダウ理論実装（USD/JPYのみ）
   - スイングポイント検出
   - 高値・安値の切り上げ/切り下げ判定
   - トレンド方向判定

5. エリオット波動基本実装
   - ZigZagインジケータ
   - 5波パターン検出（簡易版）
   - フィボナッチ計算

6. シグナル生成
   - 基本的なエントリー条件
   - シグナル強度スコア（簡易版）

#### フェーズ3: 実取引機能（1-2週間）
7. 注文機能
   - 成行注文実行
   - ストップロス・テイクプロフィット設定
   - ポジション管理

8. リスク管理
   - 2%リスク計算
   - 15%ドローダウン監視

#### フェーズ4: マルチペア対応（2-3週間）
9. 6ペア同時監視
   - 全ペアのデータ処理
   - 相関調整機能

10. 3ペア選択ロジック
    - 100点満点スコアリング
    - 動的ポジション入替

#### フェーズ5: 高度な機能（継続開発）
11. 監視・アラート機能
12. バックテスト機能
13. パラメータ最適化

### 4.2 最初の目標
**フェーズ1完了**: 「Python-MQL5間でUSD/JPYの価格データが正常に送受信できる状態」の実現

## 5. 未確定事項
- ストップロス・テイクプロフィットの具体的な方式
- 詳細なバックテスト要件
- アラート・通知機能の仕様
- パフォーマンス監視の詳細仕様

## 6. 備考
- 本システムはデモ口座での十分な検証後に実運用移行予定
- 開発は段階的に進め、各フェーズでの動作確認を重視
- リスク管理機能を最優先で実装し、安全性を確保
